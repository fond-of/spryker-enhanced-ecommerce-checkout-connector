jQuery(document).ready(function (e) {
    var datalayer = {
        "event": "genericEvent",
        "eventCategory": "ecommerce",
        "eventAction": "checkout_option",
        "eventLabel": "2",
        "ecommerce":{
            "checkout_option":{
                "actionField": {
                    "action": "checkout_option",
                    "step": "2",
                    "option": ""
                }
            }
        }
    };

    var datalayerGA4 = {
        "event": 'add_payment_info',
        "ecommerce_ga4": {
            "payment_type": '',
            "items": [
                {% for product in enhancedEcommerce.products %}
                {
                    "item_name": '{{ product.name }}',
                    "item_id": '{{ product.id }}',
                    "item_brand": '{{ product.brand }}',
                    "item_variant": '{{ product.variant }}',
                    "quantity": {{ product.quantity }},
                    {% if product.coupon is not empty %}"coupon": '{{ product.coupon }}',{% endif %}
                    "price": '{{ product.price }}'
                }{% if loop.last != true %},{% endif %}
                {% endfor %}
            ]
        }
    }

    jQuery('#paymentForm_paymentSelection').on('change', function ()  {
        availablePaymentProvider = {
            {% for key, paymentProvider in config.paymentProvider %}
                "{{ key }}": "{{ paymentProvider }}"{% if loop.last != true %},{% endif %}
            {% endfor %}
        }

        payment = availablePaymentProvider[jQuery(this).val()];
        datalayer['ecommerce']['checkout_option']['actionField']['option'] = payment;
        datalayerGA4['ecommerce_ga4']['payment_type'] = payment;

        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push(datalayer);
        window.dataLayer.push({ ecommerce_ga4: null });
        window.dataLayer.push(datalayerGA4);
    });
});
