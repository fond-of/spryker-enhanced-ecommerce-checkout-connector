datalayer = {
    "event": "genericEvent",
    "eventCategory": "ecommerce",
    "eventAction": "purchase",
    "eventLabel": "1",
    "ecommerce": {
        "currencyCode": "{{ enhancedEcommerce.ecommerce.currencyCode }}",
        "purchase": {
            "actionField": {
                "id": "{{ enhancedEcommerce.ecommerce.purchase.actionField.id }}",
                "affiliation": "{{ enhancedEcommerce.ecommerce.purchase.actionField.affiliation }}",
                "revenue": {{ enhancedEcommerce.ecommerce.purchase.actionField.revenue }},
                "tax": {{ enhancedEcommerce.ecommerce.purchase.actionField.tax }},
                {% if enhancedEcommerce.ecommerce.purchase.actionField.coupon is not empty %}"coupon": "{{ enhancedEcommerce.ecommerce.purchase.actionField.coupon }}",{% endif %}
                "shipping": {{ enhancedEcommerce.ecommerce.purchase.actionField.shipping }}
            },
            "products": [
                {% for product in enhancedEcommerce.products %}
                {
                    "id": '{{ product.id }}',
                    "name": '{{ product.name }}',
                    "variant": '{{ product.variant }}',
                    "brand": '{{ product.brand }}',
                    "dimension10": '{{ product.dimension10 }}',
                    "quantity": {{ product.quantity }},
                    {% if product.coupon is not empty %}"coupon": '{{ product.coupon }}',{% endif %}
                    "price": '{{ product.price }}'
                }{% if loop.last != true %},{% endif %}
                {% endfor %}
            ]
        }
    }
}

var datalayerGA4 = {
    "event": "purchase",
    "ecommerce_ga4": {
        "transaction_id": "{{ enhancedEcommerce.ecommerce.purchase.actionField.id }}",
        "value": {{ enhancedEcommerce.ecommerce.purchase.actionField.revenue }},
        "tax": {{ enhancedEcommerce.ecommerce.purchase.actionField.tax }},
        "shipping": {{ enhancedEcommerce.ecommerce.purchase.actionField.shipping }},
        {% if enhancedEcommerce.ecommerce.purchase.actionField.coupon is not empty %}"coupon": "{{ enhancedEcommerce.ecommerce.purchase.actionField.coupon }}",{% endif %}
        "currency": "{{ enhancedEcommerce.ecommerce.currencyCode }}"
    },
    "items": [
        {% for product in enhancedEcommerce.products %}
        {
            "item_name": '{{ product.name }}',
            "item_id": '{{ product.id }}',
            "item_brand": '{{ product.brand }}',
            "item_variant": '{{ product.variant }}',
            "quantity": {{ product.quantity }},
            {% if product.coupon is not empty %}"coupon": '{{ product.coupon }}',{% endif %}
            "price": '{{ product.price }}'
        }{% if loop.last != true %},{% endif %}
        {% endfor %}
    ]
}

window.dataLayer = window.dataLayer || [];
window.dataLayer.push(datalayer);
window.dataLayer.push({ ecommerce_ga4: null });
window.dataLayer.push(datalayerGA4);
