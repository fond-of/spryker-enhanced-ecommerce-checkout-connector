datalayer = {
    "event": "genericEvent",
    "eventCategory": "ecommerce",
    "eventAction": "purchase",
    "eventLabel": "1",
    "ecommerce": {
        "currencyCode": "{{ enhancedEcommerce.currencyCode }}",
        "purchase": {
            "actionField": {
                "id": "{{ enhancedEcommerce.purchase.id }}",
                "affiliation": "{{ enhancedEcommerce.purchase.affiliation }}",
                "revenue": {{ enhancedEcommerce.purchase.revenue }},
                "tax": {{ enhancedEcommerce.purchase.tax }},
                {% if enhancedEcommerce.purchase.coupon not empty %}"coupon": "enhancedEcommerce.purchase.coupon",{% endif %}
                "shipping": {{ enhancedEcommerce.purchase.shipping }}
            },
            "products": [
                {% for product in enhancedEcommerce.purchase.products %}
                {
                    "id": '{{ product.id }}',
                    "name": '{{ product.name }}',
                    "variant": '{{ product.variant }}',
                    "brand": '{{ product.brand }}',
                    "dimension10": '{{ product.dimension10 }}',
                    "quantity": {{ product.quantity }},
                    {% if product.coupon not empty %}"coupon": '{{ product.coupon }}',{% endif %}
                    "price": '{{ product.price }}'
                }{% if loop.last != true %},{% endif %}
                {% endfor %}
            ]
        }
    }
}

var datalayer4GA = {
    "event": "purchase",
    "ecommerce": {
        "transaction_id": "{{ enhancedEcommerce.purchase.id }}",
        "value": {{ enhancedEcommerce.purchase.revenue }},
        "tax": {{ enhancedEcommerce.purchase.tax }},
        "shipping": {{ enhancedEcommerce.purchase.shipping }},
        {% if enhancedEcommerce.purchase.coupon not empty %}"coupon": "enhancedEcommerce.purchase.coupon",{% endif %}
        currency: "{{ enhancedEcommerce.currencyCode }}"
    },
    "items": [
        {% for product in enhancedEcommerce.products %}
        {
            "item_name": '{{ product.name }}',
            "item_id": '{{ product.id }}',
            "item_brand": '{{ product.brand }}',
            "item_variant": '{{ product.variant }}',
            "quantity": {{ product.quantity }},
            {% if product.coupon not empty %}"coupon": '{{ product.coupon }}',{% endif %}
            "price": '{{ product.price }}'
        }{% if loop.last != true %},{% endif %}
        {% endfor %}
    ]
}

window.dataLayer = window.dataLayer || [];
window.dataLayer.push(datalayer);
window.dataLayer.push({ ecommerce: null });
window.dataLayer.push(datalayerGA4);
